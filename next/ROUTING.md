# Структура маршрутов

## Новая структура папок

Приложение теперь использует App Router Next.js с отдельными маршрутами для каждого раздела:

```
app/
├── (dashboard)/              # Route group - не добавляет сегмент в URL
│   ├── layout.tsx           # Общий layout с Navigation для всех страниц
│   ├── taste-map/
│   │   └── page.tsx         # /taste-map
│   ├── emotions/
│   │   └── page.tsx         # /emotions
│   ├── evolution/
│   │   └── page.tsx         # /evolution
│   ├── galaxy/
│   │   └── page.tsx         # /galaxy
│   └── friends/
│       └── page.tsx         # /friends
├── auth/
│   └── page.tsx             # /auth - страница авторизации
├── components/              # Переиспользуемые компоненты
│   ├── Navigation.tsx       # Навигация с Next.js Link
│   ├── AuthButton.tsx       # Кнопка авторизации
│   ├── AuthStatus.tsx       # Статус авторизации
│   ├── TasteMap.tsx
│   ├── EmotionalCalendar.tsx
│   ├── EvolutionTimeline.tsx
│   ├── GalaxyView.tsx
│   └── SocialHub.tsx
├── dashboard/
│   └── page.tsx            # Редирект на /taste-map
├── page.tsx                # Главная страница - проверка авторизации
└── middleware.ts           # Защита маршрутов
```

## Маршруты

### Публичные маршруты

- `/` - Главная страница (проверяет авторизацию и перенаправляет)
- `/auth` - Страница авторизации через Яндекс.Музыку

### Защищенные маршруты (требуют авторизации)

- `/taste-map` - Карта вкуса
- `/emotions` - Эмоциональный календарь
- `/evolution` - Временная линия эволюции
- `/galaxy` - Галактика
- `/friends` - Социальный хаб
- `/dashboard` - Редирект на `/taste-map`

## Логика авторизации

### Middleware (middleware.ts)

- Проверяет наличие токена `yandex_access_token` в cookies
- Перенаправляет неавторизованных пользователей с защищенных маршрутов на `/auth`
- Перенаправляет авторизованных пользователей со страницы `/auth` на `/taste-map`

### Главная страница (/)

- Проверяет наличие cookie `yandex_user`
- Если авторизован → редирект на `/taste-map`
- Если не авторизован → редирект на `/auth`

### Страница авторизации (/auth)

- Отображает кнопку "Войти через Яндекс"
- После успешной авторизации перенаправляет на `/taste-map`
- Показывает статус авторизации (успех/ошибка)

### API Endpoints

- `GET /api/auth/login` - Инициирует OAuth flow с Яндекс
- `GET /api/auth/callback` - Обрабатывает callback от Яндекс, сохраняет токен
- `GET /api/auth/user` - Возвращает информацию о текущем пользователе
- `POST /api/auth/logout` - Удаляет токены и выходит из системы

## Изменения

### Navigation.tsx

- Убраны props `activeTab` и `onTabChange`
- Добавлен `usePathname()` для определения активного маршрута
- Добавлен `useRouter()` для программной навигации
- Кнопки заменены на `<Link>` компоненты из `next/link`
- Добавлена кнопка выхода с функцией `handleLogout()`
- Каждый элемент навигации теперь имеет `href`

### AuthButton.tsx

- После успешной авторизации перенаправляет на `/taste-map`
- При выходе перенаправляет на `/auth`

### API Callback (api/auth/callback/route.ts)

- После успешной авторизации перенаправляет на `/taste-map`
- При ошибках перенаправляет на `/auth` с параметром error

### Dashboard.tsx

- Упрощен до редиректа на `/taste-map`
- Логика переключения табов удалена

### Layout

- Создан общий layout `(dashboard)/layout.tsx` для всех страниц дашборда
- Navigation вынесен в layout, чтобы не дублировать на каждой странице

## Преимущества новой структуры

1. ✅ URL меняется при переходе между разделами
2. ✅ Можно делиться прямыми ссылками на конкретные разделы
3. ✅ Работает кнопка "Назад" в браузере
4. ✅ Лучше для SEO
5. ✅ Соответствует best practices Next.js App Router
6. ✅ Защита маршрутов через middleware
7. ✅ Отдельная страница авторизации
8. ✅ Автоматическое перенаправление в зависимости от статуса авторизации
